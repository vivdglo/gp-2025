<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Rich Camera</title>

  <link rel="stylesheet" href="style.css" />

  <style>
    html, body { margin: 0; padding: 0; width: 100%; height: 100%; background: black; overflow: hidden; }

    .stage { position: fixed; inset: 0; overflow: hidden; }

    video {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      transform: scaleX(-1);
      z-index: 1;
      filter: contrast(1.15) saturate(1.2) hue-rotate(-12deg) brightness(1.03);

    }
    .hud-left {
  width: 34%;                 /* was 26% */
  display: flex;
  flex-direction: column;
  gap: 1.4rem;
}

.hud-right {
  width: 34%;                 /* was 30% */
  display: flex;
  flex-direction: column;
  gap: 1.8rem;
}
.panel {
  background: rgba(0, 0, 0, 0.42);
  border: 1px solid rgba(255, 255, 255, 0.12);
  border-radius: 1.2rem;
  padding: 1.2rem 1.2rem;
  backdrop-filter: blur(6px);
  -webkit-backdrop-filter: blur(6px);
  overflow: hidden;
}

.panel-title {
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
  font-size: 0.95rem;
  font-weight: 700;
  letter-spacing: 0.09em;
  text-transform: uppercase;
  opacity: 0.9;
  margin-bottom: 0.9rem;
}


    #faceBox {
      position: absolute;
      border: 3px solid red;
      background: transparent;
      box-sizing: border-box;
      left: -9999px;
      top: -9999px;
      width: 120px;
      height: 120px;
      z-index: 3;
      pointer-events: none;
    }

    #patientTag {
      position: absolute;
      left: -9999px;
      top: -9999px;
      z-index: 4;
      pointer-events: none;

      display: inline-flex;
      align-items: center;
      gap: 0.5rem;

      padding: 0.35rem 0.7rem;
      border-radius: 999px;
      border: 2px solid red;
      background: rgba(0,0,0,0.6);
      color: white;

      font: 13px/1 system-ui, -apple-system, Segoe UI, Roboto, Arial;
      letter-spacing: 0.02em;
      text-transform: uppercase;
    }

    .tag-icon {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: red;
      display: inline-block;
    }

    .back-btn { position: fixed; top: 1.5rem; left: 1.5rem; z-index: 10; }

    #status {
      position: fixed;
      left: 1.5rem;
      bottom: 1.5rem;
      z-index: 10;
      color: #fff;
      background: rgba(0,0,0,0.55);
      padding: 0.6rem 0.8rem;
      border-radius: 0.8rem;
      font: 14px/1.3 system-ui, -apple-system, Segoe UI, Roboto, Arial;
      max-width: 92vw;
    }
    .rich-blue-filter {
        position: absolute;
        inset: 0;
        z-index: 2;              /* above video, below box/tag */
        pointer-events: none;
        background: rgba(0, 119, 255, 0.595); /* blue hue */
        mix-blend-mode: screen;              /* nicer than normal overlay */
        /* background:
  linear-gradient(to bottom, rgba(0,120,255,0.10), rgba(0,0,0,0.35)),
  repeating-linear-gradient(
    to bottom,
    rgba(0,180,255,0.06),
    rgba(0,180,255,0.06) 2px,
    rgba(0,0,0,0) 6px,
    rgba(0,0,0,0) 10px 
    );  */

}
/* === RICH HUD OVERLAY === */
.hud {
  position: absolute;
  inset: 0;
  z-index: 2; /* above blue filter, below face box */

  display: flex;
  justify-content: space-between;
  padding: 4vh 4vw;

  opacity: 0;
  transition: opacity 2.5s ease; /* slow reveal */
  pointer-events: none;
}

.hud.visible {
  opacity: 0.85; /* slightly transparent */
}

.hud-left {
  width: 26%;
  display: flex;
  flex-direction: column;
  gap: 2.0rem;
}

.organ-row {
  display: flex;
  align-items: center;
  gap: 1.1rem;                /* more distance */

  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
  font-size: 1.05rem;         /* bigger */
  letter-spacing: 0.02em;

  opacity: 0.9;               /* more readable */
}


.organ-row img {
  width: 70px;                /* was 34px */
  height: auto;
  filter: saturate(1.1);
}


.organ-row span {
  white-space: nowrap;
}


.hud-right{
  width: 34%;
  display: grid;
  grid-template-rows: 1fr auto 1fr; /* graph (flex), recommendation (auto), agent (flex) */
  gap: 1.1rem;
  max-height: calc(100vh - 8vh);   /* because HUD has padding 4vh top/bottom */
}


.hud-graph {
  width: 100%;
}

.hud-text {
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
  font-size: 1.0rem;          /* bigger */
  line-height: 1.55;
}

.hud-text ul {
  list-style: none;
  padding: 0;
  margin: 0;
}

.hud-text li {
  opacity: 0.9;
  margin-bottom: 0.6rem;
}


/* .hud-text h3 {
  margin-bottom: 0.5rem;
  font-size: 0.85rem;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  opacity: 0.9;
}

.hud-text ul {
  list-style: none;
  padding: 0;
  margin: 0;
}

.hud-text li {
  opacity: 0.75;
} */

.agent-panel{
  display: flex;
  flex-direction: column;
  justify-content: flex-start;   /* IMPORTANT: keep title visible */
  gap: 0.9rem;
}

.agent-content{
  display: grid;
  grid-template-columns: 42% 1fr;  /* agent image + text */
  gap: 1rem;
  align-items: start;
}

.hud-agent{
  width: 100%;
  height: auto;
  max-height: 220px;             /* prevents it from pushing title off-screen */
  object-fit: contain;
  opacity: 0.95;
  justify-self: end;
}
.agent-message{
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
  font-size: 0.80rem;
  line-height: 1.5;
  color: rgba(255,255,255,0.92);
}

/* .agent-name{
  font-weight: 700;
  letter-spacing: 0.06em;
  text-transform: uppercase;
  font-size: 0.8rem;
  opacity: 0.9;
  margin-bottom: 0.4rem;
} */

.agent-message p{
  margin: 0 0 0.75rem 0;
}

.agent-muted{
  opacity: 0.75;
}
.agent-message{
  max-height: 220px;
  overflow: auto;
  padding-right: 0.25rem;
}




/* Hidden state */
.hidden {
  opacity: 0;
}


  </style>
</head>

<body>
  <button class="back-btn" onclick="location.href='index.html'">Back</button>

  <div class="stage" id="stage">
    <video id="video" autoplay playsinline muted></video>
    <!-- blue filter -->
    <div class="rich-blue-filter"></div> 
    
    <div id="richHUD" class="hud hidden">
        <!-- LEFT: ORGAN METRICS -->
    
<div class="hud-left panel">
    
    <div class="panel-title">Current health</div>
          

    <div class="organ-row">
      <img src="assets/organ-brain.png" alt="Brain">
      <span>Neural activity — 98%</span>
    </div>

    <div class="organ-row">
      <img src="assets/organ-lungs.png" alt="Lungs">
      <span>Respiratory — 89%</span>
    </div>

    <div class="organ-row">
      <img src="assets/organ-heart.png" alt="Heart">
      <span>Cardiac — 90%</span>
    </div>

    <div class="organ-row">
      <img src="assets/organ-liver.png" alt="Liver">
      <span>Hepatic — 75%</span>
    </div>

    <div class="organ-row">
      <img src="assets/organ-kidneys.png" alt="Kidneys">
      <span>Renal — 85%</span>
    </div>

    <div class="organ-row">
      <img src="assets/organ-stomach.png" alt="Stomach">
      <span>Gastric — 70%</span>
    </div>

    <div class="organ-row">
      <img src="assets/organ-colon.png" alt="Colon">
      <span>Digestive — 88%</span>
    </div>

  </div>
      
  <div class="hud-right">
    <div class="panel">
      <div class="panel-title">Health prediction analysis</div>
      <img src="assets/hud-graph.png" class="hud-graph" alt="Health prediction">
    </div>
  
    <div class="panel hud-text">
      <div class="panel-title">Recommendation</div>
      <ul>
        <li>• Cardiovascular optimization advised</li>
        <li>• Neural fatigue within normal range</li>
        <li>• Predictive anomaly risk: low</li>
      </ul>
    </div>
  
    <div class="panel agent-panel">
        <div class="panel-title">AI agent</div>
      
        <div class="agent-content">
          <img src="assets/AIassistant for rich.png" class="hud-agent" alt="AI Agent">
      
          <div class="agent-message">
            <p>
              Your baseline indicators are stable. Cardiovascular capacity is strong, and respiratory efficiency is within
              an optimal range. Hepatic performance is slightly below your personalized target.
            </p>
            <p class="agent-muted">
              Premium note: predictive monitoring indicates low anomaly risk in the next 10 years under current behavior.
            </p>
          </div>
        </div>
      </div>
      
  
      

    <div id="faceBox"></div>

    <div id="patientTag" class="rich">
        <span class="tag-icon"></span>
        <div class="tag-text">
          <div class="tag-title">Privileged patient</div>
          <div class="tag-sub">Access tier: PREMIUM</div>
        </div>
      </div>
    </div>

      <div id="status">Diagnosing...</div>

  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.20.0/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/blazeface@0.0.7/dist/blazeface.min.js"></script>

  <script>
    const videoEl = document.getElementById("video");
    const stageEl = document.getElementById("stage");
    const faceBox = document.getElementById("faceBox");
    const patientTag = document.getElementById("patientTag");
    const statusEl = document.getElementById("status");
    const richHUD = document.getElementById("richHUD");
    let hudShown = false;


    function hideOverlays() {
      faceBox.style.left = "-9999px";
      faceBox.style.top = "-9999px";
      patientTag.style.left = "-9999px";
      patientTag.style.top = "-9999px";
    }

    function placeSquareAndTagFromSourceBBox(srcX, srcY, srcW, srcH) {
      const rect = stageEl.getBoundingClientRect();
      const screenW = rect.width;
      const screenH = rect.height;

      const vidW = videoEl.videoWidth;
      const vidH = videoEl.videoHeight;
      if (!vidW || !vidH) return;

      const scale = Math.max(screenW / vidW, screenH / vidH);
      const dispW = vidW * scale;
      const dispH = vidH * scale;

      const offsetX = (screenW - dispW) / 2;
      const offsetY = (screenH - dispH) / 2;

      let x = offsetX + srcX * scale;
      let y = offsetY + srcY * scale;
      let w = srcW * scale;
      let h = srcH * scale;

      x = screenW - x - w;

      const s = Math.max(w, h);
      const cx = x + w / 2;
      const cy = y + h / 2;

      const left = cx - s / 2;
      const top = cy - s / 2;

      faceBox.style.left = `${left}px`;
      faceBox.style.top = `${top}px`;
      faceBox.style.width = `${s}px`;
      faceBox.style.height = `${s}px`;

      patientTag.style.left = `${Math.max(12, left)}px`;
      patientTag.style.top = `${Math.max(12, top - 34)}px`;
    }

    async function startCamera() {
      statusEl.textContent = "Requesting camera…";
      const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false });
      videoEl.srcObject = stream;

      await new Promise((resolve) => {
        if (videoEl.readyState >= 2) resolve();
        else videoEl.onloadedmetadata = () => resolve();
      });

      try { await videoEl.play(); } catch {}
    }

    async function start() {
      try {
        await startCamera();
      } catch (e) {
        console.error(e);
        statusEl.textContent = "Camera permission denied/unavailable.";
        return;
      }
    //   Loading face model…
      statusEl.textContent = "Identifying the patient";
      let model;
      try {
        model = await blazeface.load();
      } catch (e) {
        console.error(e);
        statusEl.textContent = "Model failed to load (check internet/CDN).";
        return;
      }
// tracking
      statusEl.textContent = "Patient is Tracked";

      async function loop() {
        try {
          const faces = await model.estimateFaces(videoEl, false);

          if (faces && faces.length > 0) {
            statusEl.textContent = "Face detected";
            const f = faces[0];
            const tl = f.topLeft;
            const br = f.bottomRight;

            const x = tl[0];
            const y = tl[1];
            const w = br[0] - tl[0];
            const h = br[1] - tl[1];

            placeSquareAndTagFromSourceBBox(x, y, w, h);
            if (!hudShown) {
                richHUD.classList.add("visible");
                richHUD.classList.remove("hidden");
                hudShown = true;
            }

          } else {
            statusEl.textContent = "No face";
            hideOverlays();
            richHUD.classList.remove("visible");
            richHUD.classList.add("hidden");
            hudShown = false;

          }
        } catch (e) {
          console.error(e);
          statusEl.textContent = "Detection error (see Console).";
          hideOverlays();
          return;
        }

        requestAnimationFrame(loop);
      }

      loop();
    }

    start();
  </script>
</body>
</html>
